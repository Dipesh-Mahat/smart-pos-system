<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart POS - Suppliers</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/menu.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Conditional Auth Service Loading -->
    <script>
        // Check if we're in development mode
        const isDevMode = sessionStorage.getItem('devMode') === 'true';
        if (isDevMode) {
            // Load development auth service
            document.write('<script src="../js/auth-service-dev.js"><\/script>');
            console.log('Loading development auth service for suppliers page');
        } else {
            // Load production auth service
            document.write('<script src="../js/auth-service.js"><\/script>');
        }
    </script>
    <script src="../js/api-service.js"></script>
    
    <!-- Check authentication on page load -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const isDevMode = sessionStorage.getItem('devMode') === 'true';
            
            if (isDevMode) {
                // In dev mode, set up mock user data
                if (window.authService && typeof window.authService.setMockUserData === 'function') {
                    window.authService.setMockUserData();
                    console.log('Development mode: Mock user data set for suppliers page');
                } else {
                    console.error('Development auth service not available');
                }
            } else {
                // In production mode, check authentication
                if (!window.authService || !window.authService.isLoggedIn()) {
                    window.location.href = '../landing.html';
                    return;
                }
                
                // Ensure token is fresh
                window.authService.ensureFreshToken();
            }
        });
    </script>

    <style>        .main-content {
            padding: 24px;
            background-color: #f8f9fa;
            min-height: auto;
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
                padding: 15px;
            }
        }        .page-title i {
            color: #007bff;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }        .search-container {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }

        .search-box {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-box input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 50px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }        .search-box input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .search-box .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            font-size: 18px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
            border: 1px solid #e9ecef;
            border-top: 4px solid #007bff;
        }

        .stat-card.active {
            border-top-color: #28a745;
        }

        .stat-card.inactive {
            border-top-color: #dc3545;
        }

        .stat-card.pending {
            border-top-color: #ffc107;
        }        .stat-icon {
            font-size: 32px;
            margin-bottom: 15px;
            color: #007bff;
        }

        .stat-card.active .stat-icon {
            color: #28a745;
        }

        .stat-card.inactive .stat-icon {
            color: #dc3545;
        }

        .stat-card.pending .stat-icon {
            color: #ffc107;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .suppliers-grid {
            display: grid;
            gap: 20px;
        }        .supplier-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .supplier-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .supplier-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .supplier-info h3 {
            font-size: 20px;
            font-weight: 700;
            color: #2c3e50;
            margin: 0 0 8px 0;
        }

        .supplier-contact {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 4px;
        }

        .supplier-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }        .status-active {
            background: #d4edda;
            color: #28a745;
        }

        .status-inactive {
            background: #f8d7da;
            color: #dc3545;
        }

        .status-pending {
            background: #fff3cd;
            color: #ffc107;
        }

        .supplier-details {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            gap: 0;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }
        .detail-item {
            flex: 1 1 0;
            text-align: center;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .detail-label {
            font-size: 13px;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0;
            font-weight: 500;
        }
        .detail-value {
            font-size: 15px;
            font-weight: 700;
            color: #2c3e50;
            margin-left: 2px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
        }

        .filters-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            align-items: center;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #e9ecef;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #6c757d;
        }

        .filter-btn.active,
        .filter-btn:hover {
            border-color: #74b9ff;
            background: #74b9ff;
            color: white;
        }

        .supplier-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }        .supplier-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #007bff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 700;
            color: white;
            margin-bottom: 15px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            color: #dee2e6;
        }

        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #495057;
        }

        .empty-state p {
            font-size: 16px;
            max-width: 400px;
            margin: 0 auto 20px;
        }
    </style>
</head>
<body>    <div class="main-content">
        <!-- Page Header -->
        <div style="display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; margin-bottom: 32px; gap: 20px;">
            <div class="page-title" style="display: flex; align-items: center; gap: 12px; font-size: 2rem; font-weight: 700; color: #2c3e50;">
                <i class="fas fa-truck"></i>
                Suppliers
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="addSupplier()">
                    <i class="fas fa-plus"></i> Add Supplier
                </button>
                <button class="btn btn-secondary" onclick="exportSuppliers()">
                    <i class="fas fa-download"></i> Export
                </button>
                <button class="btn btn-secondary" onclick="alert('Import suppliers functionality will be implemented')">
                    <i class="fas fa-upload"></i> Import
                </button>
            </div>
        </div>

        <!-- Key Insights & Quick Actions -->
        <div style="display: flex; flex-wrap: wrap; gap: 32px; margin-bottom: 32px;">
            <!-- Key Insights -->
            <div style="flex: 2 1 320px; min-width: 280px; background: white; border-radius: 14px; box-shadow: 0 2px 10px rgba(0,0,0,0.04); padding: 28px 28px 20px 28px; border: 1px solid #e9ecef;">
                <div style="font-size: 1.2rem; font-weight: 600; color: #007bff; margin-bottom: 18px; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-lightbulb"></i> Key Insights
                </div>
                <ul id="keyInsightsList" style="list-style: none; padding: 0; margin: 0; color: #495057; font-size: 1rem;">
                    <li style="margin-bottom: 12px;"><i class="fas fa-check-circle" style="color:#28a745;margin-right:8px;"></i> <span id="insight-most-active">Most suppliers are active and ready for orders.</span></li>
                    <li style="margin-bottom: 12px;"><i class="fas fa-clock" style="color:#ffc107;margin-right:8px;"></i> <span id="insight-pending">Some suppliers are pending approval.</span></li>
                    <li style="margin-bottom: 12px;"><i class="fas fa-globe" style="color:#007bff;margin-right:8px;"></i> <span id="insight-international">International suppliers are available for global sourcing.</span></li>
                    <li><i class="fas fa-boxes" style="color:#6c757d;margin-right:8px;"></i> <span id="insight-products">Suppliers offer a wide range of products.</span></li>
                </ul>
            </div>
            <!-- Quick Actions -->
            <div style="flex: 1 1 220px; min-width: 200px; background: white; border-radius: 14px; box-shadow: 0 2px 10px rgba(0,0,0,0.04); padding: 28px 28px 20px 28px; border: 1px solid #e9ecef;">
                <div style="font-size: 1.2rem; font-weight: 600; color: #007bff; margin-bottom: 18px; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-bolt"></i> Quick Actions
                </div>
                <div style="display: flex; flex-direction: column; gap: 14px;">
                    <button class="btn btn-success" style="width:100%;" onclick="addSupplier()">
                        <i class="fas fa-user-plus"></i> Add New Supplier
                    </button>
                    <button class="btn btn-secondary" style="width:100%;" onclick="exportSuppliers()">
                        <i class="fas fa-download"></i> Export Suppliers
                    </button>
                    <button class="btn btn-secondary" style="width:100%;" onclick="alert('Import suppliers functionality will be implemented')">
                        <i class="fas fa-upload"></i> Import Suppliers
                    </button>
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-truck"></i>
                </div>
                <div class="stat-value">47</div>
                <div class="stat-label">Total Suppliers</div>
            </div>
            <div class="stat-card active">
                <div class="stat-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-value">42</div>
                <div class="stat-label">Active</div>
            </div>
            <div class="stat-card pending">
                <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-value">3</div>
                <div class="stat-label">Pending</div>
            </div>
            <div class="stat-card inactive">
                <div class="stat-icon">
                    <i class="fas fa-times-circle"></i>
                </div>
                <div class="stat-value">2</div>
                <div class="stat-label">Inactive</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-container">
            <button class="filter-btn active" data-filter="all">All Suppliers</button>
            <button class="filter-btn" data-filter="active">Active</button>
            <button class="filter-btn" data-filter="pending">Pending</button>
            <button class="filter-btn" data-filter="inactive">Inactive</button>
            <button class="filter-btn" data-filter="local">Local</button>
            <button class="filter-btn" data-filter="international">International</button>
        </div>

        <!-- Suppliers Grid -->
        <div class="suppliers-grid" id="suppliersGrid">
            <!-- Suppliers will be loaded here dynamically -->
            <div class="empty-state">
                <i class="fas fa-spinner fa-spin"></i>
                <h3>Loading Suppliers...</h3>
                <p>Please wait while we fetch supplier information.</p>
            </div>
        </div>

    </div>

    <script>
        // Global variables
        let allSuppliers = [];
        let currentFilter = 'all';
        
        // Load suppliers from API
        async function loadSuppliers() {
            try {
                showLoading(true);
                
                // Debug info
                console.log('Loading suppliers...');
                console.log('Auth service:', window.authService);
                console.log('API service:', window.apiService);
                console.log('User logged in:', window.authService?.isLoggedIn());
                console.log('Current user:', window.authService?.getCurrentUser());
                
                const response = await window.apiService.get('/shop/orders/suppliers');
                console.log('Suppliers API response:', response);
                
                if (response.success) {
                    allSuppliers = response.suppliers || [];
                    displaySuppliers(allSuppliers);
                    updateStatistics(allSuppliers);
                    updateKeyInsights(allSuppliers);
                } else {
                    console.error('Failed to load suppliers:', response);
                    showError(`Failed to load suppliers: ${response.error || response.message || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('Error loading suppliers:', error);
                let errorMessage = 'Error loading suppliers. ';
                
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    errorMessage += 'Cannot connect to server. Please ensure the backend server is running.';
                } else if (error.status === 401) {
                    errorMessage += 'Authentication failed. Please log in again.';
                } else if (error.status === 403) {
                    errorMessage += 'Access denied. Please check your permissions.';
                } else {
                    errorMessage += 'Please check your connection and try again.';
                }
                
                showError(errorMessage);
            } finally {
                showLoading(false);
            }
        }

        // Display suppliers in grid
        function displaySuppliers(suppliers) {
            const grid = document.getElementById('suppliersGrid');
            
            if (!suppliers || suppliers.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-store-slash"></i>
                        <h3>No Suppliers Found</h3>
                        <p>No suppliers are available at the moment. Please check back later or contact your administrator.</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = suppliers.map(supplier => `
                <div class="supplier-card" onclick="viewSupplier('${supplier._id}')">
                    <div class="supplier-header">
                        <div class="supplier-info">
                            <div class="supplier-avatar">${getSupplierInitials(supplier)}</div>
                            <h3>${supplier.shopName || `${supplier.firstName} ${supplier.lastName}`}</h3>
                            <div class="supplier-contact">
                                <i class="fas fa-envelope"></i> ${supplier.email}
                            </div>
                            ${supplier.contactNumber ? `
                                <div class="supplier-contact">
                                    <i class="fas fa-phone"></i> ${supplier.contactNumber}
                                </div>
                            ` : ''}
                            ${supplier.address && supplier.address.city ? `
                                <div class="supplier-contact">
                                    <i class="fas fa-map-marker-alt"></i> ${formatAddress(supplier.address)}
                                </div>
                            ` : ''}
                        </div>
                        <div class="supplier-status ${getStatusClass(supplier.status)}">${supplier.status}</div>
                    </div>
                    <div class="supplier-details">
                        <div class="detail-item">
                            <span class="detail-label">Products</span>
                            <span class="detail-value">${supplier.productCount || 0}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Orders</span>
                            <span class="detail-value">${supplier.orderCount || 0}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Rating</span>
                            <span class="detail-value">${supplier.rating || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Last Order</span>
                            <span class="detail-value">${supplier.lastOrderDate ? formatDate(supplier.lastOrderDate) : 'Never'}</span>
                        </div>
                    </div>
                    <div class="supplier-actions">
                        <button class="btn btn-success" onclick="event.stopPropagation(); createOrder('${supplier._id}')">
                            <i class="fas fa-plus"></i>
                            New Order
                        </button>
                        <button class="btn btn-secondary" onclick="event.stopPropagation(); viewSupplierProducts('${supplier._id}')">
                            <i class="fas fa-boxes"></i>
                            View Products
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Update statistics based on suppliers data
        function updateStatistics(suppliers) {
            const totalCount = suppliers.length;
            const activeCount = suppliers.filter(s => s.status === 'approved').length;
            const pendingCount = suppliers.filter(s => s.status === 'pending').length;
            const inactiveCount = suppliers.filter(s => s.status === 'rejected').length;

            document.querySelector('.stat-card:nth-child(1) .stat-value').textContent = totalCount;
            document.querySelector('.stat-card:nth-child(2) .stat-value').textContent = activeCount;
            document.querySelector('.stat-card:nth-child(3) .stat-value').textContent = pendingCount;
            document.querySelector('.stat-card:nth-child(4) .stat-value').textContent = inactiveCount;
        }

        // --- Key Insights Calculation ---
        function updateKeyInsights(suppliers) {
            if (!suppliers || suppliers.length === 0) {
                document.getElementById('topSupplierName').textContent = '-';
                document.getElementById('mostProductsSupplier').textContent = '-';
                document.getElementById('mostOrdersSupplier').textContent = '-';
                document.getElementById('lastSupplierAdded').textContent = '-';
                return;
            }
            // Top Supplier (highest rating, fallback to most orders)
            let topSupplier = suppliers.slice().sort((a, b) => (b.rating || 0) - (a.rating || 0))[0];
            if (!topSupplier || !topSupplier.rating) {
                topSupplier = suppliers.slice().sort((a, b) => (b.orderCount || 0) - (a.orderCount || 0))[0];
            }
            document.getElementById('topSupplierName').textContent = topSupplier ? (topSupplier.shopName || `${topSupplier.firstName} ${topSupplier.lastName}`) : '-';
            // Most Products
            const mostProducts = suppliers.slice().sort((a, b) => (b.productCount || 0) - (a.productCount || 0))[0];
            document.getElementById('mostProductsSupplier').textContent = mostProducts ? (mostProducts.shopName || `${mostProducts.firstName} ${mostProducts.lastName}`) + ` (${mostProducts.productCount || 0})` : '-';
            // Most Orders
            const mostOrders = suppliers.slice().sort((a, b) => (b.orderCount || 0) - (a.orderCount || 0))[0];
            document.getElementById('mostOrdersSupplier').textContent = mostOrders ? (mostOrders.shopName || `${mostOrders.firstName} ${mostOrders.lastName}`) + ` (${mostOrders.orderCount || 0})` : '-';
            // Last Supplier Added (most recent _id or createdAt)
            let lastAdded = suppliers.slice().sort((a, b) => {
                if (a.createdAt && b.createdAt) return new Date(b.createdAt) - new Date(a.createdAt);
                if (a._id && b._id) return b._id.localeCompare(a._id);
                return 0;
            })[0];
            document.getElementById('lastSupplierAdded').textContent = lastAdded ? (lastAdded.shopName || `${lastAdded.firstName} ${lastAdded.lastName}`) : '-';
        }

        // Enhance Key Insights dynamically after suppliers load
        function updateKeyInsights(suppliers) {
            if (!Array.isArray(suppliers) || suppliers.length === 0) return;
            // Most active supplier
            const active = suppliers.filter(s => s.status === 'approved');
            const pending = suppliers.filter(s => s.status === 'pending');
            const international = suppliers.filter(s => s.address && s.address.country && s.address.country !== 'Nepal');
            const totalProducts = suppliers.reduce((sum, s) => sum + (s.productCount || 0), 0);
            document.getElementById('insight-most-active').textContent = `${active.length} supplier${active.length === 1 ? '' : 's'} currently active.`;
            document.getElementById('insight-pending').textContent = `${pending.length} supplier${pending.length === 1 ? '' : 's'} pending approval.`;
            document.getElementById('insight-international').textContent = `${international.length} international supplier${international.length === 1 ? '' : 's'} available.`;
            document.getElementById('insight-products').textContent = `Suppliers offer ${totalProducts} product${totalProducts === 1 ? '' : 's'} in total.`;
        }
        // Patch loadSuppliers to update insights
        const origLoadSuppliers = loadSuppliers;
        loadSuppliers = async function() {
            await origLoadSuppliers.apply(this, arguments);
            updateKeyInsights(allSuppliers);
        };
        // Helper functions
        function getSupplierInitials(supplier) {
            const name = supplier.shopName || `${supplier.firstName} ${supplier.lastName}`;
            return name.split(' ').map(word => word.charAt(0)).join('').substring(0, 2).toUpperCase();
        }

        function getStatusClass(status) {
            switch(status) {
                case 'approved': return 'status-active';
                case 'pending': return 'status-pending';
                case 'rejected': return 'status-inactive';
                default: return 'status-inactive';
            }
        }

        function formatAddress(address) {
            const parts = [address.city, address.state, address.country].filter(Boolean);
            return parts.join(', ');
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return '1 day ago';
            if (diffDays < 7) return `${diffDays} days ago`;
            if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
            return date.toLocaleDateString();
        }

        function showLoading(show) {
            const grid = document.getElementById('suppliersGrid');
            if (show) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <h3>Loading Suppliers...</h3>
                        <p>Please wait while we fetch the supplier data.</p>
                    </div>
                `;
            }
        }

        function showError(message) {
            const grid = document.getElementById('suppliersGrid');
            grid.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-exclamation-triangle" style="color: #ef476f; font-size: 64px; margin-bottom: 20px;"></i>
                    <h3 style="color: #495057; font-size: 24px; margin-bottom: 10px;">Error Loading Suppliers</h3>
                    <p style="color: #6c757d; font-size: 16px; margin-bottom: 30px;">${message}</p>
                    <button class="retry-btn" onclick="loadSuppliers()" style="
                        background: linear-gradient(135deg, #007bff, #0056b3);
                        color: white;
                        padding: 12px 24px;
                        border: none;
                        border-radius: 8px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        display: inline-flex;
                        align-items: center;
                        gap: 8px;
                        font-size: 16px;
                        box-shadow: 0 4px 15px rgba(0, 123, 255, 0.25);
                        text-decoration: none;
                        min-width: 120px;
                        justify-content: center;
                    " onmouseenter="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(0, 123, 255, 0.35)'" onmouseleave="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0, 123, 255, 0.25)'">
                        <i class="fas fa-refresh"></i>
                        Try Again
                    </button>
                </div>
            `;
        }

        // Filter functionality
        document.addEventListener('DOMContentLoaded', function() {
            loadSuppliers();
            
            const filterBtns = document.querySelectorAll('.filter-btn');
            
            // Search input will be injected into navbar, so select it after injection
            function getSearchInput() {
                return document.getElementById('searchInput');
            }

            // Filter button functionality
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    currentFilter = this.getAttribute('data-filter');
                    filterSuppliers(currentFilter);
                });
            });

            // Wait for search input to be available in navbar
            function attachSearchListener() {
                const searchInput = getSearchInput();
                if (searchInput) {
                    searchInput.addEventListener('input', function() {
                        const searchTerm = this.value.toLowerCase();
                        filterAndSearchSuppliers(currentFilter, searchTerm);
                    });
                } else {
                    setTimeout(attachSearchListener, 100);
                }
            }
            attachSearchListener();
        });

        function filterSuppliers(filter) {
            filterAndSearchSuppliers(filter, '');
        }

        function filterAndSearchSuppliers(filter, searchTerm = '') {
            let filteredSuppliers = [...allSuppliers];
            
            // Apply status filter
            if (filter !== 'all') {
                filteredSuppliers = filteredSuppliers.filter(supplier => {
                    switch(filter) {
                        case 'active':
                            return supplier.status === 'approved';
                        case 'pending':
                            return supplier.status === 'pending';
                        case 'inactive':
                            return supplier.status === 'rejected';
                        case 'local':
                            return supplier.address && supplier.address.country === 'Nepal';
                        case 'international':
                            return supplier.address && supplier.address.country !== 'Nepal';
                        default:
                            return true;
                    }
                });
            }
            
            // Apply search filter
            if (searchTerm) {
                filteredSuppliers = filteredSuppliers.filter(supplier => {
                    const searchableText = [
                        supplier.shopName,
                        supplier.firstName,
                        supplier.lastName,
                        supplier.email,
                        supplier.contactNumber,
                        supplier.address?.city,
                        supplier.address?.state,
                        supplier.address?.country
                    ].filter(Boolean).join(' ').toLowerCase();
                    
                    return searchableText.includes(searchTerm);
                });
            }
            
            displaySuppliers(filteredSuppliers);
        }

        function viewSupplier(supplierId) {
            // Redirect to the shopowner-facing supplier products page
            window.location.href = `supplier-products-shopowner.html?supplierId=${supplierId}`;
        }

        function viewSupplierProducts(supplierId) {
            // Redirect to the supplier products view
            window.location.href = `supplier-products-shopowner.html?supplierId=${supplierId}`;
        }

        function addSupplier() {
            alert('Adding new suppliers is handled through the registration system. New suppliers can register on the platform and await admin approval.');
        }

        function createOrder(supplierId) {
            // Redirect to order creation page
            window.location.href = `create-order.html?supplierId=${supplierId}`;
        }

        function exportSuppliers() {
            try {
                const dataStr = JSON.stringify(allSuppliers, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `suppliers_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
                
                showToast('Suppliers data exported successfully!', 'success');
            } catch (error) {
                console.error('Export error:', error);
                showToast('Failed to export suppliers data', 'error');
            }
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            const bgColor = type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#17a2b8';
            
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: ${bgColor};
                color: white;
                padding: 16px 24px;
                border-radius: 12px;
                z-index: 10000;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                animation: slideInUp 0.3s ease;
                max-width: 300px;
                font-weight: 500;
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOutDown 0.3s ease';
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }
    </script>

    <!-- Navbar and Menu Scripts -->
    <script src="../js/navbar.js"></script>
    <script src="../js/menu.js"></script>
    <script>
        // Initialize navbar with custom actions
        document.addEventListener('DOMContentLoaded', function() {
            const navbar = new SmartPOSNavbar();
            
            // Add custom navbar actions for suppliers
            navbar.addAction('add-supplier', 'Add Supplier', 'fas fa-plus', 'btn-primary');
            navbar.addAction('export-suppliers', 'Export', 'fas fa-download', 'btn-secondary');
            navbar.addAction('import-suppliers', 'Import', 'fas fa-upload', 'btn-secondary');
            // Handle navbar action clicks
            document.addEventListener('navbarAction', function(e) {
                switch(e.detail.actionId) {
                    case 'add-supplier':
                        addSupplier();
                        break;
                    case 'export-suppliers':
                        exportSuppliers();
                        break;
                    case 'import-suppliers':
                        console.log('Importing suppliers...');
                        alert('Import suppliers functionality will be implemented');
                        break;
                }
            });

            // Use MutationObserver to inject search bar into navbar reliably
            function injectSearchBar() {
                const navbar = document.querySelector('.smart-pos-navbar');
                if (navbar && !document.getElementById('navbarSearchContainer')) {
                    // Use the same markup as POS/products main content search bar
                    const searchHTML = `
                        <div class="navbar-center" id="navbarSearchContainer" style="flex:1;max-width:600px;margin:0 32px;">
                            <div class="search-container" style="background:white;padding:25px;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.05);margin-bottom:0;border:1px solid #e9ecef;">
                                <div class="search-box" style="max-width:100%;margin:0;">
                                    <input type="text" placeholder="Search suppliers by name, contact, or location..." id="searchInput" class="navbar-search" style="width:100%;padding:15px 50px 15px 20px;border:2px solid #e9ecef;border-radius:50px;font-size:16px;transition:all 0.3s ease;background:white;">
                                    <i class="fas fa-search search-icon" style="position:absolute;right:20px;top:50%;transform:translateY(-50%);color:#6c757d;font-size:18px;"></i>
                                </div>
                            </div>
                        </div>`;
                    const left = navbar.querySelector('.navbar-left');
                    const right = navbar.querySelector('.navbar-right');
                    if (left && right) {
                        left.insertAdjacentHTML('afterend', searchHTML);
                    }
                }
            }

            // Observe for navbar rendering
            const observer = new MutationObserver(() => {
                injectSearchBar();
            });
            observer.observe(document.body, { childList: true, subtree: true });
            // Also try once in case navbar is already present
            injectSearchBar();
        });
    </script>
</body>
</html>
